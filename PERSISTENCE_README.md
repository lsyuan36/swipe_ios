# Swipe ç…§ç‰‡æ‡‰ç”¨æŒä¹…åŒ–åŠŸèƒ½

## åŠŸèƒ½æ¦‚è¿°

Swipe ç…§ç‰‡æ‡‰ç”¨ç¾åœ¨å…·å‚™å®Œæ•´çš„æ•¸æ“šæŒä¹…åŒ–åŠŸèƒ½ï¼Œå¯ä»¥ä¿å­˜ç”¨æˆ¶çš„ç…§ç‰‡åˆ†é¡é€²åº¦å’Œç‹€æ…‹ã€‚

## æ ¸å¿ƒåŠŸèƒ½

### 1. ç…§ç‰‡ç‹€æ…‹æŒä¹…åŒ–
- **æœªè™•ç†** (unprocessed): ç”¨æˆ¶å°šæœªæ±ºå®šçš„ç…§ç‰‡
- **å·²ä¿ç•™** (kept): ç”¨æˆ¶é¸æ“‡ä¿ç•™çš„ç…§ç‰‡
- **å·²åˆªé™¤** (deleted): ç§»è‡³Appå…§åƒåœ¾æ¡¶çš„ç…§ç‰‡

### 2. é€²åº¦ä¿å­˜
- è‡ªå‹•ä¿å­˜ç”¨æˆ¶ç•¶å‰è™•ç†çš„ç…§ç‰‡ä½ç½®
- æ‡‰ç”¨é‡å•Ÿå¾Œæ¢å¾©åˆ°ä¸Šæ¬¡çš„ä½ç½®
- æ”¯æ´æ–·é»çºŒå‚³å¼çš„ç…§ç‰‡æ•´ç†

### 3. æ•¸æ“šå®‰å…¨
- **è‡ªå‹•å‚™ä»½**: æ¯30ç§’è‡ªå‹•ä¿å­˜ä¸€æ¬¡
- **å‚™ä»½æ©Ÿåˆ¶**: ä¿å­˜æ™‚è‡ªå‹•å‰µå»ºå‚™ä»½æ–‡ä»¶
- **æ‡‰ç”¨èƒŒæ™¯**: é€²å…¥èƒŒæ™¯æ™‚ç«‹å³ä¿å­˜æ•¸æ“š
- **æ•¸æ“šé©—è­‰**: å•Ÿå‹•æ™‚é©—è­‰æ•¸æ“šå®Œæ•´æ€§

### 4. é«˜ç´šåŠŸèƒ½
- **æ•¸æ“šåŒ¯å‡º**: æ”¯æ´åŒ¯å‡ºæ•´ç†æ•¸æ“šç”¨æ–¼å‚™ä»½æˆ–åˆ†äº«
- **æ•¸æ“šåŒ¯å…¥**: æ”¯æ´å¾å‚™ä»½æ¢å¾©æ•¸æ“š
- **ç‰ˆæœ¬é·ç§»**: è‡ªå‹•è™•ç†æ‡‰ç”¨ç‰ˆæœ¬å‡ç´šæ™‚çš„æ•¸æ“šç›¸å®¹æ€§
- **æ•¸æ“šä¿®å¾©**: è‡ªå‹•æª¢æ¸¬å’Œä¿®å¾©æå£çš„æ•¸æ“š

## æŠ€è¡“å¯¦ç¾

### æ•¸æ“šæ¨¡å‹
```swift
// å¯æŒä¹…åŒ–çš„ç…§ç‰‡æ•¸æ“š
struct PersistentPhotoData: Codable {
    let id: String              // PHAssetçš„localIdentifier
    var status: PhotoStatus     // ç…§ç‰‡ç‹€æ…‹
    var processedDate: Date?    // è™•ç†æ™‚é–“
    var creationDate: Date      // ç…§ç‰‡å‰µå»ºæ™‚é–“
}

// æ‡‰ç”¨ç‹€æ…‹
struct PersistentAppState: Codable {
    var photoData: [PersistentPhotoData]  // ç…§ç‰‡æ•¸æ“š
    var currentPhotoIndex: Int            // ç•¶å‰ä½ç½®
    var lastSavedDate: Date              // æœ€å¾Œä¿å­˜æ™‚é–“
    var version: String                  // æ•¸æ“šç‰ˆæœ¬
}
```

### æ•¸æ“šç®¡ç†å™¨
```swift
// å–®ä¾‹æ¨¡å¼çš„æ•¸æ“šç®¡ç†å™¨
class PhotoDataManager: ObservableObject {
    static let shared = PhotoDataManager()
    
    // ä¸»è¦æ–¹æ³•
    func savePhotoData(_ photos: [PhotoItem], currentIndex: Int)
    func loadPhotoData(for assets: [PHAsset]) -> (photos: [PhotoItem], currentIndex: Int)
    func updatePhotoStatus(_ photoItem: PhotoItem)
    func resetAllPhotosStatus(_ photos: [PhotoItem])  // æ–°å¢ï¼šé‡ç½®åŠŸèƒ½
    func exportData() -> Data?
    func importData(_ data: Data) -> Bool
}
```

## é›†æˆæ–¹å¼

### 1. æ‡‰ç”¨å•Ÿå‹•æ™‚
```swift
// åœ¨ContentViewçš„fetchPhotos()ä¸­
let (restoredPhotos, savedIndex) = dataManager.loadPhotoData(for: assets)
self.allPhotos = restoredPhotos
self.currentPhotoIndex = savedIndex
```

### 2. ç‹€æ…‹æ”¹è®Šæ™‚
```swift
// åˆªé™¤ç…§ç‰‡æ™‚
allPhotos[currentPhotoIndex].status = .deleted
dataManager.updatePhotoStatus(allPhotos[currentPhotoIndex])

// ä¿ç•™ç…§ç‰‡æ™‚  
allPhotos[currentPhotoIndex].status = .kept
dataManager.updatePhotoStatus(allPhotos[currentPhotoIndex])
```

### 3. é€²åº¦ä¿å­˜
```swift
// ç§»å‹•åˆ°ä¸‹ä¸€å¼µç…§ç‰‡æ™‚ï¼ˆå„ªåŒ–ç‰ˆæœ¬ï¼‰
// å¤§æ•¸æ“šé‡æ™‚åªä¿å­˜é€²åº¦ï¼Œé¿å…æ€§èƒ½å•é¡Œ
dataManager.saveProgressOnly(currentIndex: currentPhotoIndex)

// å°æ•¸æ“šé‡æ™‚ä»å¯ä½¿ç”¨å®Œæ•´ä¿å­˜
dataManager.savePhotoData(allPhotos, currentIndex: currentPhotoIndex)
```

### 4. é‡ç½®åŠŸèƒ½é›†æˆ
```swift
// é‡ç½®æ‰€æœ‰ç…§ç‰‡ç‹€æ…‹ï¼ˆæ–°åŠŸèƒ½ï¼‰
@State private var showingResetConfirmation = false
@State private var isResetting = false

// é¡¯ç¤ºç¢ºèªå°è©±æ¡†
Button("é‡ç½®") {
    showingResetConfirmation = true
}

// åŸ·è¡Œé‡ç½®æ“ä½œ
private func performReset() {
    isResetting = true  // é¡¯ç¤ºåŠ è¼‰å‹•ç•«
    
    // ç•°æ­¥è™•ç†é‡ç½®ï¼Œé¿å…UIé˜»å¡
    DispatchQueue.global(qos: .userInitiated).async {
        // åˆ†æ‰¹é‡ç½®ç…§ç‰‡ç‹€æ…‹
        let resetPhotos = allPhotos.map { photo in
            var resetPhoto = photo
            resetPhoto.status = .unprocessed
            resetPhoto.processedDate = nil
            return resetPhoto
        }
        
        // ä¿å­˜é‡ç½®å¾Œçš„æ•¸æ“š
        dataManager.resetAllPhotosStatus(resetPhotos)
        
        DispatchQueue.main.async {
            isResetting = false  // éš±è—åŠ è¼‰å‹•ç•«
        }
    }
}
```

## å­˜å„²ä½ç½®

- **ä¸»æ•¸æ“šæ–‡ä»¶**: `Documents/photoData.json`
- **è‡ªå‹•å‚™ä»½**: `Documents/photoData_backup.json`
- **æ‰‹å‹•å‚™ä»½**: `Documents/photoData_manual_backup_[timestamp].json`

## æ€§èƒ½ç‰¹é»

- **éåŒæ­¥ä¿å­˜**: ä½¿ç”¨èƒŒæ™¯ä½‡åˆ—ï¼Œä¸é˜»å¡UI
- **å¢é‡æ›´æ–°**: åªä¿å­˜è®Šæ›´çš„æ•¸æ“š
- **æ™ºèƒ½å¿«å–**: è¨˜æ†¶é«”ä¸­ç¶­è­·æ‡‰ç”¨ç‹€æ…‹
- **å¿«é€Ÿè¼‰å…¥**: å•Ÿå‹•æ™‚å¿«é€Ÿæ¢å¾©ç”¨æˆ¶ç‹€æ…‹
- **é‡ç½®å„ªåŒ–**: 
  - ç¢ºèªå°è©±æ¡†é˜²æ­¢èª¤æ“ä½œ
  - åˆ†æ‰¹è™•ç†é‡ç½®æ“ä½œï¼ˆæ¯æ‰¹500å¼µï¼‰
  - ç•°æ­¥åŸ·è¡Œé¿å…ç•Œé¢æŒ‚èµ·
  - è¦–è¦ºå›é¥‹å’ŒåŠ è¼‰å‹•ç•«æå‡ç”¨æˆ¶é«”é©—
- **å¤§æ•¸æ“šå„ªåŒ–**: 
  - è¶…é1è¬å¼µç…§ç‰‡æ™‚è‡ªå‹•å•Ÿç”¨å„ªåŒ–æ¨¡å¼
  - æ»‘å‹•æ™‚åªä¿å­˜é€²åº¦ï¼Œä¸ä¿å­˜æ•´å€‹é™£åˆ—
  - åˆ†æ‰¹è™•ç†æ•¸æ“šæ›´æ–°ï¼Œé¿å…ä¸»åŸ·è¡Œç·’é˜»å¡
  - æ¸›å°‘è‡ªå‹•ä¿å­˜é »ç‡ï¼Œæå‡éŸ¿æ‡‰é€Ÿåº¦

## æ•¸æ“šå®‰å…¨ä¿éšœ

1. **å¤šé‡å‚™ä»½**: ä¸»æ–‡ä»¶ + è‡ªå‹•å‚™ä»½ + æ‰‹å‹•å‚™ä»½
2. **å®Œæ•´æ€§é©—è­‰**: å•Ÿå‹•æ™‚æª¢æŸ¥æ•¸æ“šå®Œæ•´æ€§
3. **éŒ¯èª¤æ¢å¾©**: ä¸»æ–‡ä»¶æå£æ™‚è‡ªå‹•å¾å‚™ä»½æ¢å¾©
4. **ç‰ˆæœ¬ç›¸å®¹**: æ”¯æ´æ•¸æ“šæ ¼å¼å‡ç´šå’Œé™ç´š

## ç”¨æˆ¶é«”é©—

- **ç„¡æ„ŸçŸ¥ä¿å­˜**: ç”¨æˆ¶æ“ä½œæ™‚è‡ªå‹•ä¿å­˜ï¼Œç„¡éœ€æ‰‹å‹•æ“ä½œ
- **å¿«é€Ÿæ¢å¾©**: æ‡‰ç”¨é‡å•Ÿå¾Œç«‹å³æ¢å¾©åˆ°ä¸Šæ¬¡ç‹€æ…‹  
- **é€²åº¦é¡¯ç¤º**: æ¸…æ¥šé¡¯ç¤ºç•¶å‰è™•ç†é€²åº¦
- **ç‹€æ…‹ä¸€è‡´**: è·¨è¨­å‚™é‡è£å¾Œæ•¸æ“šå¯æ¢å¾©ï¼ˆé€šéåŒ¯å‡º/åŒ¯å…¥ï¼‰

## é™¤éŒ¯åŠŸèƒ½

```swift
// ç²å–æ•¸æ“šçµ±è¨ˆ
let stats = dataManager.getDataStatistics()
print("ç¸½ç…§ç‰‡æ•¸: \(stats["totalPhotos"])")
print("å·²è™•ç†: \(stats["processedCount"])")

// é‡ç½®åŠŸèƒ½é™¤éŒ¯ä¿¡æ¯
print("ğŸ”„ å¼€å§‹é‡ç½®æ‰€æœ‰ç…§ç‰‡çŠ¶æ€...")
print("âœ… é‡ç½®å®Œæˆï¼Œå…±å¤„ç† \(photos.count) å¼ ç…§ç‰‡")

// é©—è­‰æ•¸æ“šå®Œæ•´æ€§
if dataManager.validateAndRepairData() {
    print("æ•¸æ“šå·²ä¿®å¾©")
}

// å‰µå»ºæ‰‹å‹•å‚™ä»½
dataManager.createManualBackup()
```

## æœªä¾†æ“´å±•

- **iCloudåŒæ­¥**: é ç•™äº†iCloudé›†æˆä»‹é¢
- **é›²ç«¯å‚™ä»½**: æ”¯æ´å°‡æ•¸æ“šå‚™ä»½åˆ°é›²å­˜å„²
- **å¤šè¨­å‚™åŒæ­¥**: æ”¯æ´å¤šè¨­å‚™é–“çš„æ•¸æ“šåŒæ­¥
- **æ•¸æ“šåˆ†æ**: æä¾›ç…§ç‰‡æ•´ç†çš„çµ±è¨ˆåˆ†æ

## é‡è¦èªªæ˜

âš ï¸ **ç”¨æˆ¶åå¥½è¨­å®š**: æ ¹æ“šç”¨æˆ¶è¨˜æ†¶ï¼Œæ¡ç”¨Appå…§åƒåœ¾æ¡¶æ¨¡å¼ï¼Œç…§ç‰‡å…ˆæ¨™è¨˜ç‚ºåˆªé™¤ç‹€æ…‹ï¼Œç”¨æˆ¶å¯åœ¨åƒåœ¾æ¡¶ä¸­æ¢å¾©æˆ–ä¸€éµæ¸…ç©ºåˆ°ç³»çµ±åƒåœ¾æ¡¶ã€‚

âœ… **æ•¸æ“šå®‰å…¨**: æ‰€æœ‰çš„ç…§ç‰‡ç‹€æ…‹è®Šæ›´éƒ½æœƒç«‹å³æŒä¹…åŒ–ï¼Œç¢ºä¿ç”¨æˆ¶çš„æ•´ç†å·¥ä½œä¸æœƒä¸Ÿå¤±ã€‚

ğŸ“± **æ€§èƒ½å„ªåŒ–**: ä½¿ç”¨äº†é«˜æ•ˆçš„JSONåºåˆ—åŒ–å’ŒèƒŒæ™¯ä¿å­˜ï¼Œç¢ºä¿æµæš¢çš„ç”¨æˆ¶é«”é©—ã€‚

## å¤§æ•¸æ“šé‡å„ªåŒ–ï¼ˆé‡è¦ï¼‰

é‡å°ç”¨æˆ¶å›é¥‹çš„31807å¼µç…§ç‰‡å¡é “å•é¡Œï¼Œå·²å¯¦ç¾ä»¥ä¸‹å„ªåŒ–ï¼š

### è‡ªå‹•å„ªåŒ–é–¾å€¼
- **å°æ•¸æ“šé‡**ï¼ˆ<10,000å¼µï¼‰: ä½¿ç”¨æ¨™æº–ä¿å­˜æ¨¡å¼
- **å¤§æ•¸æ“šé‡**ï¼ˆâ‰¥10,000å¼µï¼‰: è‡ªå‹•å•Ÿç”¨é«˜æ€§èƒ½æ¨¡å¼

### æ€§èƒ½æå‡ç­–ç•¥
1. **æ»‘å‹•å„ªåŒ–**: æ»‘å‹•æ™‚åªä¿å­˜é€²åº¦ç´¢å¼•ï¼Œä¸ä¿å­˜æ•´å€‹ç…§ç‰‡é™£åˆ—
2. **åˆ†æ‰¹è™•ç†**: å¤§æ•¸æ“šæ›´æ–°æ™‚åˆ†æ‰¹é€²è¡Œï¼Œæ¯æ‰¹1000æ¢è¨˜éŒ„
3. **éåŒæ­¥ä¿å­˜**: æ‰€æœ‰æ–‡ä»¶æ“ä½œåœ¨èƒŒæ™¯åŸ·è¡Œç·’åŸ·è¡Œ
4. **æ™ºèƒ½é »ç‡**: å¤§æ•¸æ“šé‡æ™‚é™ä½è‡ªå‹•ä¿å­˜é »ç‡

### æ•ˆæœå°æ¯”
- **æ»‘å‹•å„ªåŒ–å‰**: 31807å¼µç…§ç‰‡æ»‘å‹•å¾Œ0.31ç§’å¡é “
- **æ»‘å‹•å„ªåŒ–å¾Œ**: æ»‘å‹•éŸ¿æ‡‰<50msï¼Œç„¡æ˜é¡¯å¡é “
- **é‡ç½®å„ªåŒ–å‰**: é‡ç½®æ“ä½œå°è‡´ç•Œé¢æŒ‚èµ·0.96ç§’
- **é‡ç½®å„ªåŒ–å¾Œ**: é‡ç½®éç¨‹æµæš¢ï¼Œæœ‰ç¢ºèªå°è©±æ¡†å’ŒåŠ è¼‰å‹•ç•«

### é™¤éŒ¯è¼¸å‡º
```
æ•¸æ“šä¿å­˜æˆåŠŸ: 15916 bytes  // åªä¿å­˜å¿…è¦æ•¸æ“š
ğŸ“¸ é è¼‰å…¥ç…§ç‰‡: 0 åˆ° 10      // æ™ºèƒ½é è¼‰å…¥ç¯„åœ
ğŸš€ å¿«é€Ÿè¼‰å…¥åœ–ç‰‡: 16BDCA07   // å¿«å–å‘½ä¸­
ğŸ”„ å¼€å§‹é‡ç½®æ‰€æœ‰ç…§ç‰‡çŠ¶æ€...  // é‡ç½®æ“ä½œé–‹å§‹
âœ… é‡ç½®å®Œæˆï¼Œå…±å¤„ç† 1257 å¼ ç…§ç‰‡  // é‡ç½®æ“ä½œå®Œæˆ
``` 